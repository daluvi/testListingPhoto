"use strict";function css_browser_selector(e){function t(){var e,t,i=window.outerWidth||u.clientWidth,r=window.outerHeight||u.clientHeight,p="";for(n.orientation=i<r?"portrait":"landscape",u.className=u.className.replace(/ ?orientation_\w+/g,"").replace(/ [min|max|cl]+[w|h]_\d+/g,""),e=a-1;e>=0;e--)if(i>=o[e]){n.maxw=o[e];break}for(t in n)n.hasOwnProperty(t)&&(p+=" "+t+"_"+n[t]);return u.className=u.className+p,p}var n={orientation:"",maxw:0},o=[320,480,640,768,1024,1152,1280,1440,1680,1920,2560],a=o.length,i=e.toLowerCase(),r=function(e){return new RegExp(e,"i").test(i)},p="gecko",d="webkit",s="chrome",c="firefox",l="safari",g="opera",$="mobile",f="android",m="blackberry",h="lang_",u=document.documentElement,x=[!/opera|webtv/i.test(i)&&/msie\s(\d+)/.test(i)?"ie ie"+(/trident\/4\.0/.test(i)?"8":RegExp.$1):r("firefox/")?p+" "+c+(/firefox\/((\d+)(\.(\d+))(\.\d+)*)/.test(i)?" "+c+RegExp.$2+" "+c+RegExp.$2+"_"+RegExp.$4:""):r("gecko/")?p:r("opera")?g+(/version\/((\d+)(\.(\d+))(\.\d+)*)/.test(i)?" "+g+RegExp.$2+" "+g+RegExp.$2+"_"+RegExp.$4:/opera(\s|\/)(\d+)\.(\d+)/.test(i)?" "+g+RegExp.$2+" "+g+RegExp.$2+"_"+RegExp.$3:""):r("konqueror")?"konqueror":r("blackberry")?m+(/Version\/(\d+)(\.(\d+)+)/i.test(i)?" "+m+RegExp.$1+" "+m+RegExp.$1+RegExp.$2.replace(".","_"):/Blackberry ?(([0-9]+)([a-z]?))[\/|;]/gi.test(i)?" "+m+RegExp.$2+(RegExp.$3?" "+m+RegExp.$2+RegExp.$3:""):""):r("android")?f+(/Version\/(\d+)(\.(\d+))+/i.test(i)?" "+f+RegExp.$1+" "+f+RegExp.$1+RegExp.$2.replace(".","_"):"")+(/Android ([\w\W]+); ([\w\W]+) Build/i.test(i)?" device_"+RegExp.$2.replace(/ /g,"_").replace(/-/g,"_"):""):r("chrome")?d+" "+s+(/chrome\/((\d+)(\.(\d+))(\.\d+)*)/.test(i)?" "+s+RegExp.$2+(RegExp.$4>0?" "+s+RegExp.$2+"_"+RegExp.$4:""):""):r("iron")?d+" iron":r("applewebkit/")?d+" "+l+(/version\/((\d+)(\.(\d+))(\.\d+)*)/.test(i)?" "+l+RegExp.$2+" "+l+RegExp.$2+RegExp.$3.replace(".","_"):/ Safari\/(\d+)/i.test(i)?"419"===RegExp.$1||"417"===RegExp.$1||"416"===RegExp.$1||"412"===RegExp.$1?" "+l+"2_0":"312"===RegExp.$1?" "+l+"1_3":"125"===RegExp.$1?" "+l+"1_2":"85"===RegExp.$1?" "+l+"1_0":"":""):r("mozilla/")?p:"",r("mobi|mobile|j2me|iphone|ipod|ipad|blackberry|playbook|kindle|silk")?$:"",r("j2me")?"j2me":r("iphone")?"iphone":r("ipod")?"ipod":r("ipad")?"ipad":r("playbook")?"playbook":r("kindle|silk")?"kindle":r("mac")?"mac"+(/mac os x ((\d+)[.|_](\d+))/.test(i)?" mac"+RegExp.$1.replace(".","_"):""):r("win")?"win"+(r("windows nt 6.2")?" win8":r("windows nt 6.1")?" win7":r("windows nt 6.0")?" vista":r("windows nt 5.2")||r("windows nt 5.1")?" win_xp":r("windows nt 5.0")?" win_2k":r("windows nt 4.0")||r("WinNT4.0")?" win_nt":""):r("freebsd")?"freebsd":r("x11|linux")?"linux":"",/[; |\[](([a-z]{2})(\-[a-z]{2})?)[)|;|\]]/i.test(i)?(h+RegExp.$2).replace("-","_")+(""!==RegExp.$3?(" "+h+RegExp.$1).replace("-","_"):""):""],v=x.join(" ").replace(/ +/g," ")+" js ";return window.onresize=t,t(),u.className=(v+u.className.replace(/(no[\-|_]?)?js/g,"")).replace(/^ /,""),v}function log(e){window.console&&showLog&&console.log(e)}function equalHeight(e){var t,n=0;e.each(function(){t=$(this).height(),t>n&&(n=t)}),e.height(n)}function ajaxProcess(e,t){$.ajax({url:"process.php",data:e,processData:!1,contentType:!1,type:"post",success:t,error:function(e,t,n){console.log(t)}})}function sortableList(){$("#ListPhoto").sortable({placeholder:"ui-state-highlight",out:function(e,t){var n=new FormData;n.append("action","reorder"),$(t.item).parents("ul").find("li").each(function(e,t){$(t).data("order",e+1),n.append("id[]",$(t).data("id")),n.append("order[]",$(t).data("order"))}),ajaxProcess(n,function(e){})}}),$("#ListPhoto").disableSelection(),$("#ListPhoto").draggable()}function htmlItem(e,t,n,o){var a=$("<li>").attr({"data-id":o,"data-order":n}),i=$("<figure>"),r=$("<figcaption>"),p=$("<p>"),d=$("<img>").attr({class:"img-responsive",width:320,height:320}),s=$("<span>").attr({"data-fancybox-type":"inline","data-fancybox-href":"#formAddEditPhoto",class:"fa fa-pencil-square-o fancy edit"}),c=$("<span>").attr({class:"fa fa-times remove"}),l=$("<div>");return p.text(e),d.attr("src",t),r.append(l),r.append(p),r.append(s),r.append(c),i.append(d),i.append(r),a.append(i)}function fancyForm(){$(".fancy").fancybox()}function addPhoto(){$(".add").on("click",function(e){e.preventDefault(),$("#action").val("add"),$("#nameImg").remove(),$("#order").remove(),$("#formPhoto img").remove(),$("#formPhoto").trigger("reset")})}function editPhoto(){$(".edit").on("click",function(e){e.preventDefault();var t=$(e.currentTarget).parents("figure").find("img").attr("src"),n=t.split("/"),o=$('<input type="hidden" name="nameImg" id="nameImg">').val(n[n.length-1]),a=$('<input type="hidden" name="order" id="order">').val($(e.currentTarget).parents("li").data("order")),i=$('<input type="hidden" name="id" id="id">').val($(e.currentTarget).parents("li").data("id")),r=$('<img class="img-responsive" width="150" height="150">').attr("src",t);$("#action").val("edit"),$("#nameImg").remove(),$("#order").remove(),$("#id").remove(),$("#formPhoto img").remove(),$("#photo").before(r),$("#description").val($(e.currentTarget).parents("figure").find("p").text()),$("#formPhoto").append(o).append(a).append(i)})}function removePhoto(){$(".remove").on("click",function(e){e.preventDefault();var t=$(e.currentTarget).parents("figure").find("img").attr("src");t=t.split("/");var n=$(e.currentTarget).parents("li").data("id");$(e.currentTarget).parents("li").remove();var o=new FormData;o.append("action","remove"),o.append("nameImg",t[t.length-1]),o.append("id",n),ajaxProcess(o,function(e){refreshContent()})})}function formPost(){var e=!1,t=!1;$("#photo").on("change",function(t){e=!0}),$("#description").on("change",function(e){t=!0}),$("#formPhoto").on("submit",function(n){if(n.preventDefault(),"add"===$("#action").val()){if(e&&t){var o=new FormData,a=$("#photo")[0].files[0],i=a.type;if(o.append("action",$("#action").val()),e){if("image/jpeg"!==i&&"image/jpg"!==i&&"image/png"!==i&&"image/gif"!==i)return!1;o.append("file",a)}else if(0===a.length)return!1;t?o.append("description",$("#description").val()):o.append("description",$("#description").val("")),o.append("order",$("#ListPhoto li").length+1),ajaxProcess(o,function(n,o,a){$("#formPhoto").trigger("reset"),e=!1,t=!1,$.fancybox.close(!0),refreshContent()})}}else if("edit"===$("#action").val()){if(!e&&!t)return!1;var r=new FormData;r.append("action",$("#action").val()),e?r.append("file",$("#photo")[0].files[0]):r.append("file",$("#formPhoto img").attr("src")),t?r.append("description",$("#description").val()):r.append("description",$("#description").val()),r.append("id",$("#id").val()),ajaxProcess(r,function(n,o,a){$("#formPhoto").trigger("reset"),e=!1,t=!1,$.fancybox.close(!0),refreshContent()})}})}function refreshContent(){var e=new FormData;e.append("action","refresh"),ajaxProcess(e,function(e,t,n){e=$.parseJSON(e),$("#countItem").text(e.length),$("#ListPhoto").empty(),$.each(e,function(e,t){$(t).length>0&&$("#ListPhoto").append(htmlItem(t.description,t.route,t.order,t.id))}),fancyForm(),editPhoto(),removePhoto(),$("img").fixBroken()})}var showLog=!0;css_browser_selector(navigator.userAgent),$(function(){refreshContent(),fancyForm(),addPhoto(),sortableList(),formPost()});